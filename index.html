<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√îN T·∫¨P T·ª™ V·ª∞NG TI·∫æNG ANH - DESTINATION B1 UNIT 24</title>
    
    <meta property="og:title" content="√îN T·∫¨P T·ª™ V·ª∞NG TI·∫æNG ANH | DESTINATION B1 | UNIT 24">
    <meta property="og:description" content="H√£y √¥n t·∫≠p t·ª´ v·ª±ng ti·∫øng Anh b·∫±ng c√°ch kh√¥ng ƒë·ªÉ ch·ªØ r∆°i m·∫•t.">
    <meta property="og:image" content="https://cdn-icons-png.flaticon.com/512/10431/10431322.png">
    <meta property="og:type" content="website">
    
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/5780/5780484.png" type="image/png">
    
    <style>
        * { box-sizing: border-box; }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(to bottom, #a0e7ff, #ffffff);
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
        }
        h1 {
            color: #1e3d59;
            margin: 10px 0 5px;
            font-size: 28px;
        }
        .control-bar {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 12px;
            margin: 10px 0 15px;
        }
        button {
            font-size: 18px;
            padding: 10px 24px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.25s;
            color: white;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }
        #start-btn     { background: #4a90e2; }
        #pause-btn     { background: #f39c12; display: none; }
        #end-btn       { background: #e74c3c; display: none; }
        #quizlet-btn   { background: #27ae60; }
        #hint-btn      { background: #f39c12; color: white; display: none; margin: 10px; }

        #score, #progress, #message {
            margin: 5px 0;
            font-size: 24px;
        }
        #progress { font-weight: bold; color: #4a90e2; }
        #message { min-height: 35px; font-weight: bold; }

        #game-area {
            margin: 10px auto;
            width: 700px;
            max-width: 95vw;
            height: 350px;
            position: relative;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            background: #ffffff;
        }

        /* Quizlet Pop-up */
        #quizlet-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            z-index: 200;
            justify-content: center;
            align-items: center;
        }
        #quizlet-modal {
            position: relative;
            background: white;
            border-radius: 16px;
            padding: 20px;
            width: 90%;
            max-width: 1000px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.4);
        }
        #quizlet-modal h2 {
            margin: 0 0 15px;
            color: #1e3d59;
            text-align: center;
        }
        #quizlet-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 32px;
            cursor: pointer;
            color: #e74c3c;
        }
        #quizlet-iframe-container {
            width: 100%;
            height: 550px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        #vietnamese-word {
            position: absolute;
            font-size: 40px;
            font-weight: bold;
            color: #1e3d59;
            left: 50%;
            transform: translateX(-50%);
            top: -80px;
            animation: fall linear forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            white-space: nowrap;
        }
        @keyframes fall { to { top: 370px; } }

        #timer {
            position: absolute;
            top: 10px; right: 15px;
            font-size: 30px;
            font-weight: bold;
            color: #e74c3c;
            background: rgba(255,255,255,0.9);
            padding: 8px 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10;
        }
        @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.15); } }

        #input-area {
            margin: 10px auto;
            padding: 15px;
            background: rgba(255,255,255,0.9);
            border-radius: 15px;
            width: 700px;
            max-width: 95vw;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
        }
        #letters-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .letter-box {
            width: 50px; height: 60px;
            font-size: 32px; font-weight: bold;
            text-align: center; line-height: 60px;
            margin: 6px;
            border: 3px solid #4a90e2;
            border-radius: 10px;
            background-color: #f0f8ff;
            color: #1e3d59;
            transition: all 0.2s;
            text-transform: uppercase;
        }
        .letter-box.filled    { background-color: #4a90e2; color: white; }
        .letter-box.correct   { background-color: #2ecc71; border-color: #27ae60; }
        .letter-box.wrong     { background-color: #e74c3c; border-color: #c0392b; }
        .letter-box.space     { background-color: #bdc3c7; border-color: #95a5a6; color: #7f8c8d; }
        .letter-box.hint      { background-color: #f39c12; border-color: #e67e22; color: white; }

        #hidden-input { position: absolute; left: -9999px; }

        #overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 100;
        }
        #result-popup {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            text-align: center;
            z-index: 101;
            display: none;
            max-width: 90%;
            width: 500px;
        }
        #result-popup h2 { font-size: 36px; color: #1e3d59; margin: 0 0 20px; }
        #play-again-btn {
            font-size: 20px;
            padding: 12px 30px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>√în T·ª´ V·ª±ng - DESTINATION UNIT 24</h1>
    
    <div class="control-bar">
        <button id="start-btn">B·∫Øt ƒê·∫ßu</button>
        <button id="pause-btn">T·∫°m D·ª´ng</button>
        <button id="end-btn">K·∫øt Th√∫c S·ªõm</button>
        <button id="quizlet-btn">Xem l·∫°i t·ª´ v·ª±ng</button>
    </div>

    <div id="score">ƒêi·ªÉm: 0</div>
    <div id="progress">T·ª´ ƒë√£ l√†m: 0 / 0</div>
    <div id="message"></div>
    <div id="game-area"></div>
    <div id="input-area">
        <div id="letters-container"></div>
    </div>
    <button id="hint-btn">G·ª£i √Ω</button>

    <input type="text" id="hidden-input" autocomplete="off">

    <!-- Quizlet Pop-up -->
    <div id="quizlet-overlay">
        <div id="quizlet-modal">
            <span id="quizlet-close">√ó</span>
            <h2>√în l·∫°i t·ª´ v·ª±ng</h2>
            <div id="quizlet-iframe-container">
                <iframe src="https://quizlet.com/1138172800/flashcards/embed?i=2xampj&x=1jj1" height="500" width="100%" style="border:0"></iframe>
            </div>
        </div>
    </div>

    <!-- Result overlay & popup -->
    <div id="overlay"></div>
    <div id="result-popup">
        <h2>üéâ Ho√†n Th√†nh! üéâ</h2>
        <p id="final-score"></p>
        <p id="hint-count"></p>
        <p id="total-time"></p>
        <button id="play-again-btn">L√†m L·∫°i</button>
    </div>

    <script>
        const originalWords = [
            { vi: "th·ª´a nh·∫≠n", en: "admit" },
            { vi: "b·∫Øt gi·ªØ", en: "arrest" },
            { vi: "t·ªï ch·ª©c t·ª´ thi·ªán; l√≤ng nh√¢n √°i", en: "charity" },
            { vi: "ph·∫°m (t·ªôi); cam k·∫øt", en: "commit" },
            { vi: "c·ªông ƒë·ªìng", en: "community" },
            { vi: "t√≤a √°n", en: "court" },
            { vi: "t·ªôi ph·∫°m; thu·ªôc t·ªôi ph·∫°m", en: "criminal" },
            { vi: "vƒÉn h√≥a", en: "culture" },
            { vi: "quen thu·ªôc", en: "familiar" },
            { vi: "ch√≠nh ph·ªß", en: "government" },
            { vi: "th√≥i quen", en: "habit" },
            { vi: "th·∫ª cƒÉn c∆∞·ªõc / CMND", en: "identity card" },
            { vi: "b·∫•t h·ª£p ph√°p", en: "illegal" },
            { vi: "ch√≠nh tr·ªã", en: "politics" },
            { vi: "d√¢n s·ªë", en: "population" },
            { vi: "nh√† t√π", en: "prison" },
            { vi: "cu·ªôc bi·ªÉu t√¨nh; bi·ªÉu t√¨nh", en: "protest" },
            { vi: "c∆∞ d√¢n", en: "resident" },
            { vi: "c√≥ tr√°ch nhi·ªám", en: "responsible" },
            { vi: "c∆∞·ªõp", en: "rob" },
            { vi: "th√≥i quen h·∫±ng ng√†y; th∆∞·ªùng l·ªá", en: "routine" },
            { vi: "l·ªãch tr√¨nh", en: "schedule" },
            { vi: "t√¨nh hu·ªëng", en: "situation" },
            { vi: "thu·ªôc x√£ h·ªôi", en: "social" },
            { vi: "x√£ h·ªôi", en: "society" },
            { vi: "ƒÉn tr·ªôm", en: "steal" },
            { vi: "truy·ªÅn th·ªëng", en: "tradition" },
            { vi: "ƒëi·ªÉn h√¨nh", en: "typical" },
            { vi: "b·ªè phi·∫øu; l√° phi·∫øu", en: "vote" },
            { vi: "c√¢u l·∫°c b·ªô thanh thi·∫øu ni√™n", en: "youth club" }
        ];

        let words = [];
        let currentWord = null;
        let score = 0;
        let hintCount = 0;
        let hintCountThisWord = 0;
        let totalLettersNeeded = 0;
        let hintedIndices = [];
        let completedCount = 0;
        let lastHintCompletedTheWord = false;
        const totalWords = originalWords.length;
        const duration = 30000; // 30 gi√¢y
        let startTime = null;
        let timerInterval = null;
        let timeoutId = null;
        let isPaused = false;
        let pauseStartTime = 0;
        let wordEl = null;

        const gameArea = document.getElementById('game-area');
        const lettersContainer = document.getElementById('letters-container');
        const hiddenInput = document.getElementById('hidden-input');
        const scoreDisplay = document.getElementById('score');
        const progressDisplay = document.getElementById('progress');
        const messageDisplay = document.getElementById('message');
        const startBtn = document.getElementById('start-btn');
        const pauseBtn = document.getElementById('pause-btn');
        const endBtn = document.getElementById('end-btn');
        const hintBtn = document.getElementById('hint-btn');
        const overlay = document.getElementById('overlay');
        const resultPopup = document.getElementById('result-popup');
        const finalScoreText = document.getElementById('final-score');
        const hintCountText = document.getElementById('hint-count');
        const totalTimeText = document.getElementById('total-time');
        const playAgainBtn = document.getElementById('play-again-btn');

        let boxes = [];
        let timerDisplay = null;

        function updateProgress() {
            progressDisplay.textContent = `T·ª´ ƒë√£ l√†m: ${completedCount} / ${totalWords}`;
        }

        function startGame() {
            startBtn.style.display = 'none';
            pauseBtn.style.display = 'inline-block';
            endBtn.style.display = 'inline-block';
            hintBtn.style.display = 'inline-block';
            score = 0;
            hintCount = 0;
            completedCount = 0;
            scoreDisplay.textContent = 'ƒêi·ªÉm: 0';
            updateProgress();
            messageDisplay.textContent = '';
            words = [...originalWords];
            startTime = Date.now();
            isPaused = false;
            nextWord();
        }

        function nextWord() {
            if (words.length === 0) {
                showResult();
                return;
            }

            const idx = Math.floor(Math.random() * words.length);
            currentWord = words[idx];
            words.splice(idx, 1);
            hintedIndices = [];
            hintCountThisWord = 0;
            lastHintCompletedTheWord = false;

            totalLettersNeeded = currentWord.en.replace(/ /g, '').length;

            gameArea.innerHTML = '';
            timerDisplay = document.createElement('div');
            timerDisplay.id = 'timer';
            gameArea.appendChild(timerDisplay);

            wordEl = document.createElement('div');
            wordEl.id = 'vietnamese-word';
            wordEl.textContent = currentWord.vi;
            gameArea.appendChild(wordEl);
            wordEl.style.animation = `fall ${duration / 1000}s linear forwards`;

            lettersContainer.innerHTML = '';
            boxes = [];

            for (let i = 0; i < currentWord.en.length; i++) {
                const box = document.createElement('div');
                box.className = 'letter-box';
                if (currentWord.en[i] === ' ') {
                    box.classList.add('space');
                    box.textContent = '‚ê£';
                }
                lettersContainer.appendChild(box);
                boxes.push(box);
            }

            hiddenInput.value = '';
            hiddenInput.focus();
            updateBoxes();
            messageDisplay.textContent = '';

            let timeLeft = 30;
            timerDisplay.textContent = timeLeft;
            clearInterval(timerInterval);
            clearTimeout(timeoutId);

            // Kh·ªüi ƒë·ªông timer hi·ªÉn th·ªã
            timerInterval = setInterval(() => {
                if (isPaused) return;
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 10) {
                    timerDisplay.style.color = '#ff0000';
                    timerDisplay.style.animation = 'pulse 0.8s infinite';
                }
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    revealAnswer();
                }
            }, 1000);

            // Timeout h·∫øt gi·ªù th·ª±c s·ª±
            timeoutId = setTimeout(() => {
                if (!isPaused) revealAnswer();
            }, duration);
        }

        function updateBoxes() {
            const typed = hiddenInput.value.toUpperCase();
            let typedIndex = 0;

            boxes.forEach((box, boxIndex) => {
                if (currentWord.en[boxIndex] === ' ') return;

                const letterIndex = getLetterIndex(boxIndex);

                if (hintedIndices.includes(letterIndex)) {
                    box.textContent = currentWord.en[boxIndex].toUpperCase();
                    box.className = 'letter-box hint filled';
                } else {
                    const char = typed[typedIndex] || '';
                    box.textContent = char;
                    box.className = 'letter-box';
                    if (char) box.classList.add('filled');
                    typedIndex++;
                }
            });
        }

        function getLetterIndex(boxIndex) {
            let count = 0;
            for (let i = 0; i <= boxIndex; i++) {
                if (currentWord.en[i] !== ' ') count++;
            }
            return count - 1;
        }

        function giveHint() {
            const cleanAnswer = currentWord.en.replace(/ /g, '').toUpperCase();
            const currentTypedBefore = getCurrentTyped();
            const wasCompleteBefore = currentTypedBefore === cleanAnswer;

            for (let i = 0; i < cleanAnswer.length; i++) {
                if (!hintedIndices.includes(i) && (currentTypedBefore[i] || '') !== cleanAnswer[i]) {
                    hintedIndices.push(i);
                    hintCount++;
                    hintCountThisWord++;
                    updateBoxes();
                    break;
                }
            }

            const currentTypedAfter = getCurrentTyped();

            if (!wasCompleteBefore && currentTypedAfter === cleanAnswer) {
                lastHintCompletedTheWord = true;
                checkAnswer();
            }

            hiddenInput.focus();
        }

        function getCurrentTyped() {
            let result = '';
            let typedIndex = 0;

            for (let i = 0; i < currentWord.en.length; i++) {
                if (currentWord.en[i] === ' ') continue;

                const letterIndex = getLetterIndex(i);

                if (hintedIndices.includes(letterIndex)) {
                    result += currentWord.en[i].toUpperCase();
                } else {
                    result += (hiddenInput.value.toUpperCase()[typedIndex] || '');
                    typedIndex++;
                }
            }
            return result;
        }

        function completeCurrentWord() {
            completedCount++;
            updateProgress();
        }

        function checkAnswer() {
            if (!timeoutId || isPaused) return;
            clearTimeout(timeoutId);
            clearInterval(timerInterval);
            timeoutId = null;

            const correct = currentWord.en.replace(/ /g, '').toUpperCase();
            const current = getCurrentTyped();

            if (current === correct && !lastHintCompletedTheWord) {
                score++;
                scoreDisplay.textContent = `ƒêi·ªÉm: ${score}`;
                messageDisplay.textContent = 'üéâ ƒê√∫ng r·ªìi! +1 ƒëi·ªÉm üéâ';
                messageDisplay.style.color = '#2ecc71';
                boxes.forEach(box => {
                    if (!box.classList.contains('space')) {
                        box.classList.remove('hint');
                        box.classList.add('correct');
                    }
                });
            } else if (current === correct && lastHintCompletedTheWord) {
                messageDisplay.textContent = '‚úÖ ƒê√∫ng nh∆∞ng d√πng g·ª£i √Ω ch·ªØ cu·ªëi ‚Äì Kh√¥ng t√≠nh ƒëi·ªÉm';
                messageDisplay.style.color = '#f39c12';
                boxes.forEach(box => {
                    if (!box.classList.contains('space')) {
                        box.classList.add('hint');
                    }
                });
            } else {
                messageDisplay.textContent = `‚ùå Sai r·ªìi! ƒê√°p √°n: ${currentWord.en}`;
                messageDisplay.style.color = '#e74c3c';
                boxes.forEach((box, i) => {
                    if (currentWord.en[i] !== ' ') {
                        box.textContent = currentWord.en[i].toUpperCase();
                        box.classList.remove('hint');
                        box.classList.add('wrong');
                    }
                });
            }

            completeCurrentWord();
            setTimeout(nextWord, lastHintCompletedTheWord ? 3000 : 2500);
        }

        function revealAnswer() {
            if (isPaused) return;
            clearInterval(timerInterval);
            clearTimeout(timeoutId);
            timeoutId = null;
            messageDisplay.textContent = `‚è∞ H·∫øt gi·ªù! ƒê√°p √°n: ${currentWord.en}`;
            messageDisplay.style.color = '#f39c12';

            boxes.forEach((box, i) => {
                if (currentWord.en[i] !== ' ') {
                    box.textContent = currentWord.en[i].toUpperCase();
                    box.style.backgroundColor = '#f39c12';
                    box.style.borderColor = '#e67e22';
                    box.style.color = 'white';
                    box.classList.remove('hint');
                }
            });

            completeCurrentWord();
            setTimeout(nextWord, 3000);
        }

        function showResult() {
            clearInterval(timerInterval);
            clearTimeout(timeoutId);
            const totalTime = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(totalTime / 60);
            const seconds = totalTime % 60;
            const timeStr = `${minutes} ph√∫t ${seconds.toString().padStart(2, '0')} gi√¢y`;

            finalScoreText.innerHTML = `‚úÖ ƒê√∫ng (c√≥ ƒëi·ªÉm): <strong>${score}</strong> / ${totalWords}<br>‚ùå Sai/H·∫øt gi·ªù/G·ª£i √Ω ch·ªØ cu·ªëi: <strong>${totalWords - score}</strong>`;
            hintCountText.textContent = `üí° S·ªë l·∫ßn d√πng g·ª£i √Ω: ${hintCount}`;
            totalTimeText.textContent = `‚è± T·ªïng th·ªùi gian: ${timeStr}`;

            overlay.style.display = 'block';
            resultPopup.style.display = 'block';
            pauseBtn.style.display = 'none';
            endBtn.style.display = 'none';
            hintBtn.style.display = 'none';
        }

        function togglePause() {
            if (!currentWord || words.length === totalWords) return;

            if (isPaused) {
                // Ti·∫øp t·ª•c
                const pausedDuration = Date.now() - pauseStartTime;
                startTime += pausedDuration;

                // Kh·ªüi ƒë·ªông l·∫°i timer hi·ªÉn th·ªã
                timerInterval = setInterval(() => {
                    if (isPaused) return;
                    const elapsed = Date.now() - startTime;
                    let timeLeft = Math.max(0, Math.floor((duration - elapsed) / 1000));
                    timerDisplay.textContent = timeLeft;

                    if (timeLeft <= 10) {
                        timerDisplay.style.color = '#ff0000';
                        timerDisplay.style.animation = 'pulse 0.8s infinite';
                    }
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        revealAnswer();
                    }
                }, 200);

                // Kh·ªüi ƒë·ªông l·∫°i timeout th·ª±c
                const remainingTime = duration - (Date.now() - startTime);
                timeoutId = setTimeout(() => {
                    if (!isPaused) revealAnswer();
                }, Math.max(0, remainingTime));

                if (wordEl) wordEl.style.animationPlayState = 'running';
                pauseBtn.textContent = 'T·∫°m D·ª´ng';
                isPaused = false;
            } else {
                // T·∫°m d·ª´ng
                pauseStartTime = Date.now();
                clearInterval(timerInterval);
                clearTimeout(timeoutId);
                timerInterval = null;
                timeoutId = null;

                if (wordEl) wordEl.style.animationPlayState = 'paused';
                pauseBtn.textContent = 'Ti·∫øp T·ª•c';
                isPaused = true;
            }
        }

        function endEarly() {
            if (confirm("B·∫°n mu·ªën k·∫øt th√∫c s·ªõm v√† xem k·∫øt qu·∫£ ngay kh√¥ng?")) {
                clearTimeout(timeoutId);
                clearInterval(timerInterval);
                showResult();
            }
        }

        hiddenInput.addEventListener('input', () => {
            const hintedCount = hintedIndices.length;
            const maxAllowedInput = totalLettersNeeded - hintedCount;

            if (hiddenInput.value.length > maxAllowedInput) {
                hiddenInput.value = hiddenInput.value.slice(0, maxAllowedInput);
            }

            updateBoxes();

            const currentTypedLength = getCurrentTyped().length;
            if (currentTypedLength === totalLettersNeeded) {
                lastHintCompletedTheWord = false;
                checkAnswer();
            }
        });

        hiddenInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                const currentTypedLength = getCurrentTyped().length;
                if (currentTypedLength > 0 && currentTypedLength <= totalLettersNeeded) {
                    lastHintCompletedTheWord = false;
                    checkAnswer();
                }
            }
        });

        // Event listeners
        startBtn.addEventListener('click', startGame);
        pauseBtn.addEventListener('click', togglePause);
        endBtn.addEventListener('click', endEarly);
        hintBtn.addEventListener('click', giveHint);
        playAgainBtn.addEventListener('click', () => {
            overlay.style.display = 'none';
            resultPopup.style.display = 'none';
            startGame();
        });

        // Quizlet modal
        const quizletBtn = document.getElementById('quizlet-btn');
        const quizletOverlay = document.getElementById('quizlet-overlay');
        const quizletClose = document.getElementById('quizlet-close');

        quizletBtn.addEventListener('click', () => {
            quizletOverlay.style.display = 'flex';
        });

        quizletClose.addEventListener('click', () => {
            quizletOverlay.style.display = 'none';
        });

        quizletOverlay.addEventListener('click', (e) => {
            if (e.target === quizletOverlay) quizletOverlay.style.display = 'none';
        });

        gameArea.addEventListener('click', () => hiddenInput.focus());
        lettersContainer.addEventListener('click', () => hiddenInput.focus());
    </script>
</body>
</html>
